<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤©æ°”æ•°æ®å¼‚æ­¥æŸ¥è¯¢æ¼”ç¤º</title>
    <style>
        body {
            background-color: #f0fafa;
            font-family: 'å¾®è½¯é›…é»‘', sans-serif;
        }
        table {
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <h1 style="color: #2c3e50; text-align: center">å®æ—¶å¤©æ°”æ•°æ®å¹³å°</h1>
    <div id="demo"></div>

    <script>
        // åŸºç¡€å¼‚æ­¥æ¼”ç¤º
        setTimeout(() => {
            console.log('[ç³»ç»Ÿ] å¤©æ°”æ•°æ®ç¼“å­˜å·²æ›´æ–°')
        }, 2000)
        console.log('[å¯åŠ¨] å¤©æ°”æœåŠ¡åˆå§‹åŒ–...')

        // è·å–åŸå¸‚åŸºç¡€æ•°æ®
        function fetchCityData() {
            return new Promise((resolve) => {
                setTimeout(() => {
                    console.log('âœ… å·²åŠ è½½åŸå¸‚åœ°ç†ä¿¡æ¯')
                    resolve();
                }, 1000)
            })
        }
        
        // å¼‚æ­¥è·å–è¯¦ç»†å¤©æ°”
        async function getWeatherDetails(cityCode) {
            await new Promise((resolve) => {
                setTimeout(() => {
                    console.log(`ğŸŒ¤ æ­£åœ¨è·å– ${cityCode} çš„å¤©æ°”æ•°æ®`)
                    resolve();
                }, 1000)
            });
        }

        // ä¸»æŸ¥è¯¢æµç¨‹
        (async () => {
            await fetchCityData();
            console.log('[ç³»ç»Ÿ] åŸºç¡€æœåŠ¡å‡†å¤‡å°±ç»ª');
        })();

        // å¤©æ°”APIæŸ¥è¯¢å‡½æ•°
        async function getWeatherHistory(city) {
            const url = `https://api.weather.com/v1/${city}/history`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('å¤©æ°”æœåŠ¡æš‚ä¸å¯ç”¨');
                }
                const weatherData = await response.json();
                const metrics = weatherData.map(day => ({
                    date: day.forecastDate,
                    temp: `${day.minTemp}â„ƒ ~ ${day.maxTemp}â„ƒ`
                }));
                return metrics;
            } catch (error) {
                console.error('âŒ æ•°æ®è·å–å¤±è´¥:', error);
                return [];
            }
        }

        // å±•ç¤ºå¤©æ°”æ•°æ®è¡¨æ ¼
        function showWeatherTable(metrics) {
            let html = `<table border="1" cellpadding="8" style="border-collapse: collapse">
                <tr style="background-color: #e3f2fd">
                    <th>æ—¥æœŸ</th>
                    <th>æ¸©åº¦èŒƒå›´</th>
                </tr>`;
                
            metrics.forEach((item, index) => {
                html += `<tr>
                    <td>${item.date}</td>
                    <td style="color: ${index < 3 ? '#e74c3c' : '#2ecc71'}">${item.temp}</td>
                </tr>`;
            });
            
            html += '</table>';
            document.getElementById('demo').innerHTML = html;
        }

        // ç¤ºä¾‹è°ƒç”¨
        getWeatherHistory('BEIJING')
            .then(data => {
                console.log('æœ€æ–°å¤©æ°”æ•°æ®:', JSON.stringify(data));
                showWeatherTable(data);
            });
    </script>
</body>
</html>